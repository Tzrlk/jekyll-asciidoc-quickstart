<!doctype html>
<html lang="en" itemscope itemtype="http://schema.org/Blog">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<title itemprop="name">Tzrlk: Understandable Frustration</title>

	<meta name="description" itemprop="description"
	      content="The personal site of Peter Cummuskey" />

	<meta name="author" itemprop="author"
	      content="Peter Cummuskey" />

	<meta name="copyright"
	      content="Peter Cummuskey 2016" />

	<!-- Assets -->
	<link rel="stylesheet"
	      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
	      integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0="
	      crossorigin="anonymous" />

	<!-- CONSIDER SWITCHING TO http://bulma.io/
	<link rel="stylesheet"
	      href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.1/css/bulma.min.css"
	      integrity="sha256-n+Ch7oRdzZ9+8/inp+1mK/0Bt4T/2PSmo4L6YGoDiVM="
	      crossorigin="anonymous" />-->

	<!-- Styles -->
	<link rel="stylesheet"
	      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css"
	      integrity="sha256-HxaKz5E/eBbvhGMNwhWRPrAR9i/lG1JeT4mD6hCQ7s4="
	      crossorigin="anonymous" />
	<link rel="stylesheet"
	      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css"
	      integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w="
	      crossorigin="anonymous" />
	<link rel="stylesheet"
	      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.10/css/bootstrap-material-design.min.css"
	      integrity="sha256-j3CLSRG31GkOu6kaeLh7XsRgL2YNvRl9aOtXoAYt320="
	      crossorigin="anonymous" />
	<link rel="stylesheet"
	      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.10/css/ripples.min.css"
	      integrity="sha256-+Og2qJI9qzvKYwhGo/LYXg0FzE1BhEQfDsUSjKXQ3Bg="
	      crossorigin="anonymous" />
	<link rel="stylesheet"
	      href="https://cdn.rawgit.com/richleland/pygments-css/master/tango.css" />

</head>
<body>


<!-- Nav Bar -->

<nav class="navbar navbar-default" data-topbar>
	<div class="container-fluid">

		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-top" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">Tzrlk</a>
		</div>

		<div class="collapse navbar-collapse" id="nav-top">
			<ul class="nav navbar-nav">

				<li role="presentation">
					<a href="/about">About Me</a>
				</li>

			</ul>
		</div>

	</div>
</nav>
<!-- End Nav -->


<div class="container-fluid">

	<aside class="col-md-3 col-lg-2">
		<div class="row">

			<nav class="col-xs-12 col-sm-4 col-md-12">
				<h4>Contents</h4>
				<div id="toc"></div>
			</nav>

			<section class="col-xs-12 col-sm-4 col-md-12">
				<h4>Flair</h4>
				<a href="https://stackexchange.com/users/18122" class="panel">
					<img src="https://stackexchange.com/users/flair/18122.png?theme=clean"
					     width="208" height="58" alt="Tzrlk on Stackexchange"/>
				</a>
			</section>

		</div>
	</aside>

	<main class="col-md-9 col-lg-10" role="content">
		<div class="container" style="margin-left: 0;">

			<div class="post" itemscope itemtype="http://schema.org/BlogPosting">

	<header class="post-header">
		<h1 class="post-title" itemprop="name">Understandable Frustration</h1>
		<p class="post-meta">
			<meta itemprop="keywords" content="" />
			<span itemprop="author" itemscope itemtype="http://schema.org/Person">
				<a href="/about" rel="author" itemprop="url">Peter Cummuskey</a>
			</span>
			<span class="hyphen">-</span>
			<time itemprop="datePublished" datetime="2016-11-07T00:00:00+13:00">
				Nov 7, 2016
			</time>
		</p>
	</header>

	<article class="post-content" itemprop="articleBody">
		<p>With any luck, venting about this here will lead me to the correct answer via the highly effective process of <a href="https://en.wikipedia.org/wiki/Rubber_duck_debugging">Rubber Duck Debugging</a>.</p>

<p>So, I’ve been attempting to convert the haphazard pile of bash scripts used to prevent bad pushes to the git repository at work into an invoked cli jar compiled from kotlin. For the most part, the conversion process has gone well. I haven’t had the chance to properly refactor and reengineer it yet, but that should come after I can get the damn tests passing.</p>

<p>I had already been using <a href="http://lmgtfy.com/?q=shunit2">shunit2</a> via <a href="https://github.com/aetheric/shunit2">my own ‘fork’ of it</a> to make sure all the bash scripts worked like I expected, but as you might imagine, that was super clunky to run and maintain. Converting everything to kotlin was fairly straightforward, and I ended up using a neat set of libraries:</p>

<ul>
  <li>
    <p><a href="https://github.com/npryce/hamkrest">hamkrest</a></p>
  </li>
  <li>
    <p><a href="https://github.com/springockito/springockito">springockito</a></p>
  </li>
  <li>
    <p><a href="https://github.com/nhaarman/mockito-kotlin">mockito-kotlin</a></p>
  </li>
  <li>
    <p><a href="https://github.com/pholser/junit-quickcheck">junit-quickcheck</a></p>
  </li>
  <li>
    <p><a href="https://github.com/avh4/junit-nested">junit-nested</a></p>
  </li>
</ul>

<p>Haven’t ended up getting too much use out of quickcheck just yet, but mockito-kotlin and hamkrest have been amazing in a kotlin environment. They’re little more than a thin veneer on top of the relevant libraries, but it makes things much simpler to write.</p>

<p>The thing that’s driving me nuts at the moment, however, is a pair of tests keep failing for a clear reason, but without the needed context to fix it. I even ended up creating a series of wrapper classes to avoid needing to mock things like RevCommit and ObjectId (jgit), but to no avail. Each and every time I run the damn thing I get the same set of errors.</p>

<p>The problem is the stacktrace ends up being useless, since it’s only points to the place where the library raised the error, rather than the place that the error is complaining about. A few libraries like angularjs are notorious for this complete lack of context in their errors, meaning you end up waiting for the error to be thrown, then debugging backward through the process until you find what’s wrong.</p>

<p>Of course, in my case, the problem <a href="https://www.youtube.com/watch?v=BUsSPAFmauY&amp;feature=youtu.be&amp;t=33s">is like an onion</a>. Every time I think I’ve stumbled across what’s causing the damn errors, I just uncover a new one that makes just as little sense as the first. Observe:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>java.lang.ClassCastException:
    org.mockito.internal.creation.cglib.ClassImposterizer
    $ClassWithSuperclassToWorkAroundCglibBug
    $EnhancerByMockitoWithCGLIB
    $$8b138c7f cannot be cast to
    ...tools.git.wrappers.ObjectIdWrapper
</code></pre>
</div>

<p>I love how descriptive the class names are, but it tells me almost nothing about why the hell this is happening. Casting that class should be perfectly fine if its ‘extending’ ObjectIdWrapper. The only thing I can think of is that it’s a bug somewhere between mockito and kotlin, and if that’s the case, then I should just flip a table and give up trying to have testable code.</p>

<p>Of course, in my efforts to get one test working, I end up breaking a bunch of other ones. Fml. Maybe I’ll have a flash of inspiration, but seeing how things have progressed so far makes that a very dim possibility.</p>

	</article>

</div>


		</div>
	</main>

</div>


<footer class="container-fluid">
	<div class="col-xs-12">
		<div class="row">

			<ol class="breadcrumb">
				<li><a href="http://aetheric.co.nz/">Aetheric Engineering</a></li>
				<li><a href="">Tzrlk</a></li>
				<li class="active">Understandable Frustration: </li>
			</ol>

		</div>
	</div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>

<!-- Polyfills -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"
        integrity="sha256-0rguYS0qgS6L4qVzANq4kjxPLtvnp5nn2nB5G1lWRv4="
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"
        integrity="sha256-t6SrqvTQmKoGgi5LOl0AUy+lBRtIvEJ+++pLAsfAjWs="
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-placeholder/2.3.1/jquery.placeholder.min.js"
        integrity="sha256-vo4hFjZ2XisF8ql7P6kGVCDAbuW68h6P2WunwD+QI54="
        crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"
        integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8="
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.10/js/material.min.js"
        integrity="sha256-uZbIqasulk7Y9yEwknbeQ0FpF3aUhtPwuggbpvQaI8Y="
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.10/js/ripples.min.js"
        integrity="sha256-TY/EO/++Ug/P+fSBjaqlmtuphCBKwlP7TOnS+SGnN8g="
        crossorigin="anonymous"></script>

<script src="/js/toc.js"></script>
<script type="text/javascript">
$(document).ready(function() {
	$('#toc').toc({
		headers: 'h2, h3',
		listClasses: 'nav nav-pills nav-stacked'
	});
});
</script>

</body>
</html>
