<!doctype html>
<html lang="en" itemscope itemtype="http://schema.org/Blog">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<title itemprop="name">Tzrlk: Fixing Docker Swarm state on Windows</title>

	<meta name="description" itemprop="description"
	      content="The personal site of Peter Cummuskey" />

	<meta name="author" itemprop="author"
	      content="Peter Cummuskey" />

	<meta name="copyright"
	      content="Peter Cummuskey 2016" />

	<!-- Assets -->
	<link rel="stylesheet"
	      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
	      integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0="
	      crossorigin="anonymous" />

	<!-- CONSIDER SWITCHING TO http://bulma.io/
	<link rel="stylesheet"
	      href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.1/css/bulma.min.css"
	      integrity="sha256-n+Ch7oRdzZ9+8/inp+1mK/0Bt4T/2PSmo4L6YGoDiVM="
	      crossorigin="anonymous" />-->

	<!-- Styles -->
	<link rel="stylesheet"
	      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css"
	      integrity="sha256-HxaKz5E/eBbvhGMNwhWRPrAR9i/lG1JeT4mD6hCQ7s4="
	      crossorigin="anonymous" />
	<link rel="stylesheet"
	      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css"
	      integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w="
	      crossorigin="anonymous" />
	<link rel="stylesheet"
	      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.10/css/bootstrap-material-design.min.css"
	      integrity="sha256-j3CLSRG31GkOu6kaeLh7XsRgL2YNvRl9aOtXoAYt320="
	      crossorigin="anonymous" />
	<link rel="stylesheet"
	      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.10/css/ripples.min.css"
	      integrity="sha256-+Og2qJI9qzvKYwhGo/LYXg0FzE1BhEQfDsUSjKXQ3Bg="
	      crossorigin="anonymous" />
	<link rel="stylesheet"
	      href="https://cdn.rawgit.com/richleland/pygments-css/master/tango.css" />

</head>
<body>


<!-- Nav Bar -->

<nav class="navbar navbar-default" data-topbar>
	<div class="container-fluid">

		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-top" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">Tzrlk</a>
		</div>

		<div class="collapse navbar-collapse" id="nav-top">
			<ul class="nav navbar-nav">

				<li role="presentation">
					<a href="/about">About Me</a>
				</li>

			</ul>
		</div>

	</div>
</nav>
<!-- End Nav -->


<div class="container-fluid">

	<aside class="col-md-3 col-lg-2">
		<div class="row">

			<nav class="col-xs-12 col-sm-4 col-md-12">
				<h4>Contents</h4>
				<div id="toc"></div>
			</nav>

			<section class="col-xs-12 col-sm-4 col-md-12">
				<h4>Flair</h4>
				<a href="https://stackexchange.com/users/18122" class="panel">
					<img src="https://stackexchange.com/users/flair/18122.png?theme=clean"
					     width="208" height="58" alt="Tzrlk on Stackexchange"/>
				</a>
			</section>

		</div>
	</aside>

	<main class="col-md-9 col-lg-10" role="content">
		<div class="container" style="margin-left: 0;">

			<div class="post" itemscope itemtype="http://schema.org/BlogPosting">

	<header class="post-header">
		<h1 class="post-title" itemprop="name">Fixing Docker Swarm state on Windows</h1>
		<p class="post-meta">
			<meta itemprop="keywords" content="" />
			<span itemprop="author" itemscope itemtype="http://schema.org/Person">
				<a href="/about" rel="author" itemprop="url">Peter Cummuskey</a>
			</span>
			<span class="hyphen">-</span>
			<time itemprop="datePublished" datetime="2017-05-26T00:00:00+12:00">
				May 26, 2017
			</time>
		</p>
	</header>

	<article class="post-content" itemprop="articleBody">
		<p>So, after smashing my head against the desk for a good few hours, I finally figured-out how to clear a ‘pending’ docker swarm state, and get things back-on-track.</p>

<p>Usually, you’d just run <code class="highlighter-rouge">docker swarm leave</code> or even adding <code class="highlighter-rouge">--force</code>, but in this case, the only response received is <code class="highlighter-rouge">Error response from daemon: context deadline exceeded</code>. Not very helpful.</p>

<p>Adding <code class="highlighter-rouge">--debug</code> and <code class="highlighter-rouge">--log-level=debug</code> to the invocation doesn’t provide any more useful information, either. Restarting the service doesn’t do anything, and the internet isn’t too helpful (hence this post).</p>

<p>After reading <a href="https://forums.docker.com/t/how-can-i-ssh-into-the-betas-mobylinuxvm/10991">This article</a>, I noticed something very significant:</p>

<blockquote>
  <p>As a temporary workaround I manually found the location of docker inside the VM by mounting various bits of its filesystem as a volume in a container and then ls-ing, and I’ve hardcoded that location in my scripts, but that’s not a great solution.</p>
</blockquote>

<p>Realising that I might be able to actually mount the file system of the moby vm, I tried my luck with <code class="highlighter-rouge">docker run -it --rm -v /var/lib/docker/:/var/lib/docker/ alpine:3.5 sh</code>. Miracles of miracles it worked flawlessly, so I followed that up with <code class="highlighter-rouge">rm -rf swarm</code>, exited the container, and restarted the service. A subsequent call to <code class="highlighter-rouge">docker info</code> showed me exactly what I wanted: no mention of docker swarm.</p>

<p>Now I can get on with peeling the next few layers of the onion, and maybe I’ll be able to actually get something working. My plan is to install a local <a href="http://rancher.com/">Rancher</a> instance and use it to admin other machines via ssh. Ranting about docker tooling is for another day.</p>


	</article>

</div>


		</div>
	</main>

</div>


<footer class="container-fluid">
	<div class="col-xs-12">
		<div class="row">

			<ol class="breadcrumb">
				<li><a href="http://aetheric.co.nz/">Aetheric Engineering</a></li>
				<li><a href="">Tzrlk</a></li>
				<li class="active">Fixing Docker Swarm state on Windows: </li>
			</ol>

		</div>
	</div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>

<!-- Polyfills -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"
        integrity="sha256-0rguYS0qgS6L4qVzANq4kjxPLtvnp5nn2nB5G1lWRv4="
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"
        integrity="sha256-t6SrqvTQmKoGgi5LOl0AUy+lBRtIvEJ+++pLAsfAjWs="
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-placeholder/2.3.1/jquery.placeholder.min.js"
        integrity="sha256-vo4hFjZ2XisF8ql7P6kGVCDAbuW68h6P2WunwD+QI54="
        crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"
        integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8="
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.10/js/material.min.js"
        integrity="sha256-uZbIqasulk7Y9yEwknbeQ0FpF3aUhtPwuggbpvQaI8Y="
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.10/js/ripples.min.js"
        integrity="sha256-TY/EO/++Ug/P+fSBjaqlmtuphCBKwlP7TOnS+SGnN8g="
        crossorigin="anonymous"></script>

<script src="/js/toc.js"></script>
<script type="text/javascript">
$(document).ready(function() {
	$('#toc').toc({
		headers: 'h2, h3',
		listClasses: 'nav nav-pills nav-stacked'
	});
});
</script>

</body>
</html>
